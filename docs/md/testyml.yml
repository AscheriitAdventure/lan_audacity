version: '3.8'

services:
  mariadb:
    image: mariadb:latest
    env_file:
      - ./dev/.env.dev  # Pour l'environnement de d√©veloppement
      # - ./prod/.env.prod  # Pour l'environnement de production
    environment:
      MYSQL_ROOT_PASSWORD: ${MARIADB_PASSWORD}
      MYSQL_DATABASE: ${MARIADB_DATABASE}
    volumes:
      - ./dev/server_mariadb_dev/data:/var/lib/mysql
      - ./dev/server_mariadb_dev/conf:/etc/mysql/conf.d
      - ./dev/server_mariadb_dev/logs:/var/log/mysql
    ports:
      - "3306:3306"
    networks:
      - lan_network

  mongodb:
    image: mongo:latest
    env_file:
      - ./dev/.env.dev
      # - ./prod/.env.prod  # Pour l'environnement de production
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGODB_USER}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGODB_PASSWORD}
    volumes:
      - ./dev/server_mongodb_dev/data:/data/db
      - ./dev/server_mongodb_dev/logs:/var/log/mongodb

  lan-audacity-app:
    build: ./dev/lan-audacity_app_dev
    env_file:
      - ./dev/.env.dev
      # - ./prod/.env.prod  # Pour l'environnement de production
    environment:
      APP_PORT: ${APP_PORT}
      LOG_LEVEL: ${LOG_LEVEL}
    ports:
      - "${APP_PORT}:5678"
    volumes:
      - ./dev/lan-audacity_app_dev/src:/app/src
      - ./dev/lan-audacity_app_dev/data:/app/data
      - ./dev/lan-audacity_app_dev/logs:/app/logs
    depends_on:
      - mariadb
      - mongodb
    networks:
      - lan_network

networks:
    lan_network:
        driver: bridge